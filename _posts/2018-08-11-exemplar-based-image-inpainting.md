---
layout: article
title:  exemplar-based image inpainting matlab
date:   2018-08-11 20:02:58 +0800
categories: [blog]
tags: [matlab, inpainting]
mathjax: true
---

### 1 æ¦‚è¿°

æœ¬ä»£ç æ˜¯å¯¹`Region filling and object removal by exemplar-based image inpainting`çš„`MATLAB`å®ç°ï¼Œç”¨æ¥å¯¹å›¾åƒè¿›è¡ŒåŒºåŸŸå¡«å……ã€ç‰©ä½“ç§»é™¤ã€‚

ğŸ˜›ğŸ˜œğŸ˜ä»£ç æ‰˜ç®¡åœ¨`github`ä¸Šï¼š[exemplar-based-image-inpainting](https://github.com/jonzhaocn/exemplar-based-image-inpainting)
### 2 ç®—æ³•
å¦‚å›¾1æ‰€ç¤ºï¼Œä¸ºç®—æ³•ä¼ªä»£ç ã€‚
![å›¾1 ç®—æ³•ä¼ªä»£ç ](/imgs/exemplar-based-image-inpainting/pseudo-code.png)

#### 2.1 åŒºåŸŸåˆ’åˆ†
å®ç°è¿™ä¸ªç®—æ³•ï¼Œé¦–å…ˆéœ€è¦è¿›è¡Œå›¾åƒåŒºåŸŸçš„åˆ’åˆ†ã€‚å¦‚å›¾2æ‰€ç¤ºï¼Œ$\Omega$ä¸ºç›®æ ‡åŒºåŸŸï¼Œæ˜¯éœ€è¦è¿›è¡Œå¡«å……çš„åŒºåŸŸï¼Œ$\phi$ä¸ºæºåŒºåŸŸï¼Œä½œä¸ºå¡«å……æ•°æ®çš„æ¥æºã€‚$\Omega$çš„è¾¹ç•Œä¸º$\delta\Omega$ã€‚å¦‚æœä»åƒç´ å€¼æ¥çœ‹çš„è¯ï¼Œå¯ä»¥å°†ç›®æ ‡åŒºåŸŸçš„åƒç´ å€¼è®¾ç½®ä¸º`0`ï¼Œä½†æ˜¯`0`åœ¨å›¾åƒä¸­ä¸ºé»‘è‰²çš„æ„æ€ï¼Œæ‰€ä»¥æœ€å¥½å¯ä»¥æœ‰ä¸€ä¸ªè¾…åŠ©æ•°ç»„æ¥æ ‡å¿—ç¼ºå¤±åŒºåŸŸã€‚
![å›¾2 åŒºåŸŸåˆ’åˆ†ä¸è¾¹ç•Œ](/imgs/exemplar-based-image-inpainting/boundary.png)

#### 2.2 è®¡ç®—è¾¹ç•ŒåŒºåŸŸ
ä½¿ç”¨ä¸‹é¢çš„ä»£ç å¯ä»¥æ–¹ä¾¿åœ°è®¡ç®—å‡ºè¾¹ç•Œç‚¹çš„ä½ç½®ã€‚`map`æ˜¯ä¸€ä¸ªäºŒå€¼æ•°ç»„ï¼Œåªæœ‰0ã€1ï¼Œå…¶ä¸­1è¡¨ç¤ºç¼ºå¤±åƒç´ å€¼æ‰€åœ¨ä½ç½®ã€‚è®¡ç®—å‡ºæ¥çš„ç»“æœ`result`ä¸­ï¼Œ1æ‰€åœ¨çš„ä½ç½®å°±æ˜¯è¾¹ç•Œç‚¹æ‰€åœ¨çš„ä½ç½®ã€‚
```matlab
result = imdilate(map, se) - map;
```
#### 2.3 ä¼˜å…ˆçº§çš„è®¡ç®—å…¬å¼
è¾¹ç•Œä¸Šæœ‰å¾ˆå¤šåƒç´ ç‚¹ï¼Œä»¥è¿™äº›ç‚¹ä¸ºä¸­å¿ƒå¯ä»¥å¾—åˆ°å¾ˆå¤špatchï¼ˆæ¯”å¦‚9Ã—9çš„patchï¼‰ï¼Œå¯¹äºè¿™äº›patchï¼Œéƒ½éœ€è¦è®¡ç®—ä¸€ä¸‹ä»–ä»¬çš„ä¼˜å…ˆçº§æ˜¯å¤šå°‘ï¼Œä»¥ä¾¿ä»ä¸­é€‰å‡ºä¸€ä¸ªä¼˜å…ˆçº§æœ€å¤§çš„å—ä½œä¸ºé¦–è¦ä¿®å¤çš„å¯¹è±¡ã€‚

* å¯¹äºä¸€ä¸ªpatchï¼Œå—çš„ä¼˜å…ˆçº§è®¡ç®—å…¬å¼ï¼š
$P(p)=C(p) \ast D(p) \tag{1}$
å…¶ä¸­ï¼Œ$p$ä»£è¡¨è¿™ä¸ªå¾…ä¿®å¤å—çš„ä¸­å¿ƒç‚¹ï¼Œ$C(p)$è¡¨ç¤ºå—çš„ç½®ä¿¡åº¦ï¼Œ$D(p)$ä¸ºdata termã€‚

* ç½®ä¿¡åº¦çš„è®¡ç®—å…¬å¼æ˜¯ï¼š
$C(p)=\frac{\sum_{q\in\psi_p\cap(I-\Omega)} c(q)}{\psi_p} \tag{2}$
å…¶ä¸­ï¼Œ$C(p)$è¡¨ç¤ºç½®ä¿¡åº¦ï¼Œå…¶ä¸­$I$ä¸ºæ•´å¼ å›¾åƒï¼Œ$\Omega$ä¸º$I$çš„ç¼ºå¤±åŒºåŸŸï¼Œ$\psi_p$ä¸ºå¾…å¡«å……çš„å—ï¼Œ$|\psi_p|$ä¸ºå—çš„é¢ç§¯ã€‚$c(q)$ä¸ºå—ä¸­çš„åƒç´ ç‚¹çš„ç½®ä¿¡åº¦ï¼Œåœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå·²å­˜åœ¨çš„åƒç´ ç‚¹çš„ç½®ä¿¡åº¦ä¸º`1`ï¼Œç¼ºå¤±çš„åƒç´ ç‚¹çš„ç½®ä¿¡åº¦ä¸º`0`ï¼Œåœ¨ä¿®å¤è¿‡ç¨‹ä¸­ï¼Œä¿®å¤å‡ºæ¥çš„åƒç´ ç‚¹çš„ç½®ä¿¡åº¦è¢«æ›´æ–°ä¸ºå—çš„ç½®ä¿¡åº¦$C(p)$ï¼Œç”±æ­¤å¯çŸ¥ï¼Œéšç€ä¿®å¤è¿‡ç¨‹çš„æ¨è¿›ï¼Œä¿®å¤å‡ºæ¥çš„åƒç´ ç‚¹çš„ç½®ä¿¡åº¦ä¼šè¶Šæ¥è¶Šå°ã€‚

* data termçš„è®¡ç®—å…¬å¼ä¸ºï¼š
$D(p) =\frac{|\bigtriangledown I^{\perp}_p \ast n_p|}{\alpha} \tag{3}$
å…¬å¼3ï¼Œè¿™é‡Œæ˜¯ç­‰ç…§åº¦å‘é‡ä¸æ³•å‘é‡$n_p$çš„ç‚¹ä¹˜å†æ±‚æ¨¡é•¿ï¼Œ$\alpha$ä¸ºå½’ä¸€åŒ–å› å­ã€‚
åœ¨è®¡ç®—ç­‰ç…§åº¦å‘é‡çš„æ—¶å€™éœ€è¦å…ˆè®¡ç®—$p$ç‚¹çš„`image gradient`ï¼Œç­‰ç…§åº¦çº¿å‘é‡ä¸º`gradient`é€†æ—¶é’ˆæ—‹è½¬90Â°ï¼Œ`gradient`ä»£è¡¨äº†åƒç´ å€¼å˜åŒ–æœ€å¿«çš„æ–¹å‘ï¼Œè€Œç­‰ç…§åº¦çº¿å‘é‡ä¸`gradient`å‚ç›´ï¼Œä»£è¡¨äº†å˜åŒ–æœ€æ…¢çš„æ–¹å‘ã€‚
* image gradient
$\bigtriangledown f = [ \begin{matrix} g_x \\ g_y \end{matrix}]=[ \begin{matrix} \frac{\partial f}{\partial x} \\ \frac{\partial f}{\partial y} \end{matrix}] \tag{4}$
#### 2.4 æš´åŠ›æœç´¢
è®¡ç®—å‡ºæ¯ä¸€ä¸ªpatchçš„ä¼˜å…ˆçº§ä¹‹åï¼Œä»ä¸­é€‰å‡ºä¸€ä¸ªä¼˜å…ˆçº§æœ€é«˜çš„patchä½œä¸ºå¾…ä¿®å¤å¯¹è±¡ï¼Œå¦‚$Pt$ã€‚å†ä½¿ç”¨æš´åŠ›æ³•ï¼Œä»æºåŒºåŸŸä¸­é€‰å‡ºä¸€ä¸ªä¸ä¹‹æœ€ç›¸è¿‘çš„å—$Ps$ï¼Œå°†$Ps$ä¸­å¯¹åº”çš„åƒç´ æ‹·åˆ°$Pt$ä¸­ï¼ˆè¿™é‡Œåªéœ€è¦ä¿®å¤$Pt$ä¸­ç¼ºå¤±çš„åƒç´ ç‚¹ï¼‰ã€‚ä½¿ç”¨æš´åŠ›æ³•çš„æ—¶å€™ï¼Œè¡¡é‡ä¸¤ä¸ªå—ä¹‹é—´çš„è·ç¦»æ—¶ï¼Œä½¿ç”¨`SSD`ï¼ˆå·®çš„å¹³æ–¹å’Œï¼‰ä½œä¸ºè·ç¦»ï¼Œç”±äº$Pt$æœ¬èº«å°±ç¼ºå¤±äº†éƒ¨åˆ†åƒç´ å€¼ï¼Œæ‰€ä»¥è®¡ç®—çš„å°±æ˜¯$Pt$éç¼ºå¤±åƒç´ å’Œå…¶ä»–patchå¯¹åº”ä½ç½®åƒç´ å€¼çš„`SSD`ã€‚

æ³¨æ„ï¼Œåœ¨ä¿®å¤è¿‡ç¨‹çš„è¿­ä»£ä¸­ï¼Œç¼ºå¤±åŒºåŸŸé€æ¸å˜å°ï¼Œä½†æ˜¯æä¾›åƒç´ æ¥æºçš„ç›®æ ‡åŒºåŸŸå›ºå®šä¸å˜ã€‚å› ä¸ºç›®æ ‡åŒºåŸŸä¸­ï¼Œä¿®å¤å‡ºæ¥çš„åƒç´ å€¼å¯ä¿¡åº¦æ¯”è¾ƒä½ï¼Œä¸äºˆä»¥é‡‡ç”¨ã€‚
### 3 ä¿®å¤ç»“æœ
![åŸå›¾](/imgs/exemplar-based-image-inpainting/original-image.png)
![ç¼ºå¤±ä¿¡æ¯](/imgs/exemplar-based-image-inpainting/masked-image.png)
![ä¿®å¤ä¹‹å](/imgs/exemplar-based-image-inpainting/inpainted-image.png)

### 4 å‚è€ƒæ–‡çŒ®
1. `Criminisi A, PÃ©rez P, Toyama K. Region filling and object removal by exemplar-based image inpainting[J]. IEEE Transactions on image processing, 2004, 13(9): 1200-1212.`
2. `Criminisi A, Perez P, Toyama K. Object removal by exemplar-based inpainting[C]//Computer Vision and Pattern Recognition, 2003. Proceedings. 2003 IEEE Computer Society Conference on. IEEE, 2003, 2: II-II.`
3. `https://github.com/IouJenLiu/Region-Filling-and-Object-Removal`